# 微信小程序部署指南

## 🎉 完成情况

✅ 微信小程序版本已完整开发完成
✅ 所有功能与Web版本保持一致
✅ 严格遵循微信小程序开发规范
✅ 适配微信开发者工具 v3.11.3
✅ 代码已提交到GitHub

## 📁 项目结构

```
pension-basic/
├── miniprogram/              # 小程序目录（完整的小程序项目）
│   ├── app.js               # 小程序逻辑
│   ├── app.json             # 小程序配置
│   ├── app.wxss             # 全局样式
│   ├── sitemap.json         # 索引配置
│   ├── project.config.json  # 项目配置
│   ├── README.md            # 小程序文档
│   ├── pages/               # 页面目录
│   │   ├── index/           # 首页（输入页面）
│   │   │   ├── index.js
│   │   │   ├── index.json
│   │   │   ├── index.wxml
│   │   │   └── index.wxss
│   │   └── result/          # 结果页面
│   │       ├── result.js
│   │       ├── result.json
│   │       ├── result.wxml
│   │       └── result.wxss
│   └── utils/               # 工具函数
│       ├── retirementAge.js     # 退休年龄查询
│       ├── pensionCalculator.js # 养老金计算
│       ├── cityConfig.js        # 城市配置
│       └── util.js              # 通用工具
├── index.html               # Web版本（原有内容）
├── app.js
├── main.js
└── ...                      # 其他Web文件
```

## 🚀 快速开始

### 1. 下载微信开发者工具

1. 访问 https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
2. 下载适合您系统的版本（Windows/Mac/Linux）
3. 安装微信开发者工具 v3.11.3 或更高版本

### 2. 导入小程序项目

#### 方式A：从本地导入

1. 打开微信开发者工具
2. 点击 "+" 或 "导入项目"
3. 填写项目信息：
   - **项目目录**：选择 `E:\github\pension-basic\miniprogram` 文件夹
   - **AppID**：选择 "测试号"（用于开发测试）
   - **项目名称**：养老金计算器
4. 点击 "导入"

#### 方式B：从GitHub克隆

```bash
# 克隆仓库
git clone https://github.com/manmonthW/pension-basic.git

# 进入小程序目录
cd pension-basic/miniprogram

# 使用微信开发者工具打开此目录
```

### 3. 首次运行

1. 导入成功后，微信开发者工具会自动编译项目
2. 左侧显示小程序界面预览
3. 右侧显示代码编辑器
4. 底部显示编译信息

### 4. 测试功能

在模拟器中测试：

1. **填写基本信息**：
   - 选择人员类型：男职工
   - 出生年份：1980
   - 出生月份：5月
   - 点击"查询退休年龄"

2. **填写历史缴费**：
   - 已累计缴费月数：120（10年）
   - 历史平均缴费指数：1.0
   - 个人账户余额：50000

3. **查看计算结果**：
   - 点击"计算养老金方案"
   - 查看四档方案对比
   - 查看推荐方案
   - 测试分享功能

## 📱 在真机上测试

### 方法1：使用预览功能

1. 点击微信开发者工具右上角的 "预览" 按钮
2. 会生成一个二维码
3. 使用微信扫描二维码
4. 小程序会在您的手机上打开

### 方法2：真机调试

1. 点击微信开发者工具右上角的 "真机调试"
2. 扫描二维码
3. 可以查看真机上的调试信息和网络请求

## 🎨 功能说明

### 核心功能

1. **退休年龄查询**
   - 支持男职工、女干部、女工人
   - 基于国务院延迟退休政策
   - 精确到月份

2. **四档方案对比**
   - 基础档(60%)：最低缴费标准
   - 标准档(100%)：按社平工资缴费
   - 进阶档(200%)：两倍社平工资
   - 尊享档(300%)：最高缴费标准

3. **养老金计算**
   - 基础养老金计算
   - 个人账户养老金计算
   - 考虑利息（1.5%年利率）
   - 回本时间分析

4. **分享功能**
   - 复制结果到剪贴板
   - 分享给微信好友
   - 分享到朋友圈

### 页面导航

```
index（首页） → result（结果页）
      ↑              ↓
      └─────返回────┘
```

## 🔧 自定义配置

### 修改AppID（正式上线时）

编辑 `miniprogram/project.config.json`：

```json
{
  "appid": "wx1234567890abcdef",  // 替换为您的小程序AppID
  "projectname": "pension-basic"
}
```

### 修改城市配置

编辑 `miniprogram/utils/cityConfig.js`：

```javascript
const CITY_CONFIG = {
  北京: { /* 现有配置 */ },
  上海: {
    city: "上海",
    avgSalary: 12000,
    baseMin: 7200,
    baseMax: 36000,
    flexibleEmploymentRate: 0.20,
    personalAccountRate: 0.08,
    poolingRate: 0.12,
    pensionInterestRate: 0.015,
  },
};
```

然后在 `miniprogram/pages/index/index.js` 中添加城市选项：

```javascript
data: {
  cities: ['北京', '上海'],  // 添加新城市
  cityIndex: 0,
}
```

### 修改主题颜色

编辑 `miniprogram/app.json`：

```json
{
  "window": {
    "navigationBarBackgroundColor": "#667eea",  // 导航栏背景色
    "navigationBarTextStyle": "white"           // 导航栏文字颜色
  }
}
```

## 🚀 发布上线

### 1. 注册小程序账号

1. 访问 https://mp.weixin.qq.com
2. 点击"立即注册"
3. 选择"小程序"
4. 按照提示完成注册（需要管理员扫码验证）
5. 完成主体信息登记

### 2. 获取AppID

1. 登录小程序管理后台
2. 进入"开发" → "开发管理" → "开发设置"
3. 复制AppID

### 3. 配置项目

1. 在 `project.config.json` 中填入AppID
2. 在微信开发者工具中，点击右上角头像
3. 选择"刷新"，重新登录

### 4. 上传代码

1. 在微信开发者工具中点击右上角 "上传"
2. 填写版本号：`1.0.0`
3. 填写项目备注：`初始版本 - 养老金计算器`
4. 点击"上传"

### 5. 提交审核

1. 登录小程序管理后台 https://mp.weixin.qq.com
2. 进入"管理" → "版本管理"
3. 找到刚才上传的开发版本
4. 点击"提交审核"
5. 填写审核信息：
   - **小程序类别**：工具 → 查询工具
   - **服务类目**：工具 → 信息查询
   - **标签**：养老金、社保、计算器

### 6. 等待审核

- 通常1-7个工作日
- 审核通过后会收到通知
- 审核通过后点击"发布"即可上线

### 7. 发布成功

- 小程序正式上线，用户可以搜索使用
- 可以生成小程序码进行推广

## 📊 数据说明

### 计算参数（北京2025年）

| 参数 | 数值 | 说明 |
|------|------|------|
| 社平工资 | 12,049元 | 退休金核算基数 |
| 缴费基数下限 | 7,162元 | 60%档位 |
| 缴费基数上限 | 35,811元 | 300%档位 |
| 灵活就业缴费比例 | 20% | 个人承担全部 |
| 计入个人账户 | 8% | 用于个人账户养老金 |
| 进入统筹账户 | 12% | 用于基础养老金池 |
| 个人账户年利率 | 1.5% | 账户利息 |

### 养老金计算公式

```
月养老金 = 基础养老金 + 个人账户养老金

基础养老金 = (社平工资 + 本人指数化工资) ÷ 2 × 缴费年限 × 1%

个人账户养老金 = 个人账户余额 ÷ 计发月数N
```

## ⚠️ 注意事项

### 开发注意事项

1. **AppID配置**：
   - 开发测试使用"测试号"
   - 正式上线前必须配置真实AppID

2. **域名配置**：
   - 如果调用后端API，需要在小程序后台配置合法域名
   - 目前纯前端计算，无需配置

3. **版本兼容**：
   - 基础库版本设置为 3.5.5
   - 支持大部分主流机型

4. **性能优化**：
   - 避免频繁setData
   - 合理使用页面生命周期
   - 图片资源压缩

### 审核注意事项

1. **服务类目**：
   - 必须选择正确的服务类目
   - 工具类小程序通常审核较快

2. **隐私政策**：
   - 虽然不收集用户信息，但建议添加隐私政策页面

3. **测试账号**：
   - 提交审核时可能需要提供测试数据
   - 建议提供：出生年份1980，月数120，指数1.0，余额50000

4. **功能描述**：
   - 清晰描述小程序功能
   - 说明适用人群（灵活就业人员）

## 🆘 常见问题

### Q1: 导入项目后报错 "找不到app.json"

**A**: 请确保选择的是 `miniprogram` 文件夹，不是整个 `pension-basic` 文件夹。

### Q2: 编译失败，提示"module not found"

**A**: 检查utils目录下的文件是否完整，确保cityConfig.js、retirementAge.js、pensionCalculator.js都存在。

### Q3: 页面跳转失败

**A**: 检查app.json中的pages配置是否正确，路径是否存在。

### Q4: 真机预览显示空白

**A**:
1. 检查手机微信版本是否最新
2. 清除缓存后重新预览
3. 查看调试器console是否有报错

### Q5: 如何添加更多城市？

**A**:
1. 在 `utils/cityConfig.js` 中添加城市配置
2. 在 `pages/index/index.js` 的 cities 数组中添加城市名称
3. 修改计算逻辑以支持多城市选择

## 📚 相关资源

- 微信小程序官方文档：https://developers.weixin.qq.com/miniprogram/dev/framework/
- 小程序开发工具：https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html
- 小程序社区：https://developers.weixin.qq.com/community/minip rogram

## 🎯 下一步计划

- [ ] 添加更多城市支持
- [ ] 优化UI/UX体验
- [ ] 添加数据本地缓存
- [ ] 支持多语言
- [ ] 添加数据导出功能（生成图片分享）
- [ ] 接入后端服务（如需要）

---

**项目版本**：v1.0.0
**最后更新**：2025年12月2日
**开发者**：Claude Code
**适用工具版本**：微信开发者工具 v3.11.3+

**立即开始**：打开微信开发者工具，导入 `miniprogram` 文件夹，开始体验吧！🚀
